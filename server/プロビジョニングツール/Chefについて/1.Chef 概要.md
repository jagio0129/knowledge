# 1.Chef 概要

[参考](http://knowledge.sakura.ad.jp/tech/867/)

サーバ管理ツール「Chef（シェフ）」は、ファイルに記述した設定内容に応じて自動的にユーザの作成やパッケージのインストール、設定ファイルの編集などを行うツール。米Opscodeが開発しているオープンソースソフトウェアで、Rubyなどのオープンソースな技術を使って実装されている。「Cookbook（クックブック）」や「Recipe（レシピ）」と呼ばれる設定ファイルの再利用がしやすい構造になっている点が特徴だ。

## Chefのアーキテクチャと構成要素

**Chefでは設定内容を記述したファイル**のことを「**Recipe**」と呼ぶ。RecipeはRubyの実行ファイルとなっており、その拡張子は.rbだ。

また**Recipeの管理単位**を「**Cookbook**」と呼ぶ。CookbookにはRecipeに加え、、**設定ファイルを作成するため**の「**Temple**」や、**環境に応じてその値を変更できる変数を定義した「Attribute**」などが含まれている。Chefでは処理内容や対象とするアプリケーションごとにCookbookを作成するのが一般的で、Recipeでは環境に依存しないように設定を記述し、Attributeでその内容を制御するという使い方が推奨されている。Recipe内からはほかのCookbookやRecipeを参照して利用することも可能・

Chefで**管理対象とするサーバーの設定項目や設定ファイルなど**は「**Resource**」と呼ばれる。リソースには型（リソースタイプ）があり、例えばユーザの作成や削除には「user」というリソースタイプを、Yumによるパッケージ操作については「yum_package」というリソースタイプを利用する。Chefでは基本的なシステム管理に必要となるリソースタイプがあらかじめで用意されているほか、Cookbook内で新たなリソースタイプを定義することも可能だ。

Cookbookは自分で作成するだけでなく、公開されているものを利用することも可能だ。Opscodeが[運営するコミュニティサイト](http://community.opscode.com/)にはChefを開発するOpscodeやサードパーティの開発者によって作成されたCookbookがまとめられており、無料でダウンロードできる。

公開されているCookbookは、MySQLやApacheといったアプリケーションのインストールや設定を行うものからユーザの作成などシステム管理に関わるもの、iptablesなどOSの特定機能の設定を行うものまで、多岐にわたる。これらを利用することで、自分ではほとんどRecipeを書くことなしにサーバの設定を行うことも可能だ。

## Chefによるサーバ管理構成

Chefを利用するための構成としては、 **一台のサーバ内でCookbookの作成や管理、実行などを全て完結させるスタンドアロン構成** と **Cookbookをサーバーで集中管理し、クライアントはサーバーからCookbookをダウンロードして実行するというクライアント/サーバー構成** の二通りがある。

スタンドアロン構成の場合、サーバーソフトウェアのインストールは不要で、クライアントのみが必要。Recipeの実行はクライアントに含まれる「chef-solo」というコマンドで行う。

一方クライアント/サーバー構成の場合、サーバー側にはChefサーバ、「Node」と呼ばれるクライアント側にはChefクライアントのインストールが必要となる。

クライアント/サーバー構成の場合、サーバ側でRecipeの作成や検証作業を行ってもいいのだが、このような作業は別マシン上で行うこともできる。このようにRecipeの作成や管理を行うマシンのことを「Workstation」を呼ぶ。Workstationでのレシピの作成や環境管理などには「knife」を言うツールを利用する。knifeはChefクライアントをインストールすると同時にインストールされる。

以降で使用される環境は、クライアント/サーバーともにRed Hat Enterprise Linux 6.4互換であるCentOS6.4(x8_64)だ
